---           
layout: post
title: Printing html using the embedded web browser control
date: 2013-01-07 20:02:47 UTC
updated: 2013-01-07 20:02:47 UTC
comments: false
categories: C# How To
---
<br /><div class="MsoNormal"><span lang="EN-US">In this post I’ll try to answer some questions about the web browser control and provide some workarounds for known issues involved in the printing process.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">I'm assuming that you have some experience with the web browser control and basic knowledge of COM and hosting APIs. So I’m not going to cover those topics.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">At the bottom of this page I’ve added the links to download a small library I wrote that takes care of printing HTML and a demo app so you can try it out without having to write any code by yourself.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"></span></div><div class="MsoNormal"><b>Using the code<o:p></o:p></b></div><div class="MsoNormal"></div><div class="MsoNormal"><span lang="EN-US">The <b>HtmlPrinter</b> class will allow you to print html from an URL or just passing the html as string, you can also specify the title and the number of copies you want to print. The code may look something like this:</span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-zUa8Zyu1Qe4/UCGT9v04LVI/AAAAAAAAAQk/luaZMAS5l-U/s1600/using-the-code.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-zUa8Zyu1Qe4/UCGT9v04LVI/AAAAAAAAAQk/luaZMAS5l-U/s1600/using-the-code.png" /></a></div><div class="MsoNormal"><span lang="EN-US">Now that we know how to use the API let get answer some questions.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><b><br /></b></span></div><div class="MsoNormal"><span lang="EN-US"><b>Why my app crashes when I try to print multiple copies of a page?</b> <a href="http://www.blogger.com/blogger.g?blogID=6425405359281783065" name="_GoBack"></a><o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"></span></div><div class="MsoNormal"><span lang="EN-US">Well, apparently when you send a lot of print commands to the web browser control, there is a lot of COM crap in between that leave the control into nonresponsive state and after a couple of calls, your app will hang and eventually it will die.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US">I ran into this issue a couple of days ago and I can solve it adding this code inside the print method:<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-BLXIX3CfkBM/UCGUZGnRtcI/AAAAAAAAAQs/c_prR1eit8M/s1600/print-without-crash.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="352" src="http://4.bp.blogspot.com/-BLXIX3CfkBM/UCGUZGnRtcI/AAAAAAAAAQs/c_prR1eit8M/s640/print-without-crash.png" width="640" /></a></div><div class="MsoNormal"><span lang="EN-US">While the COM API is busy, we just keep on pumping messages to the OS loop, avoiding app hungups, when the API es ready, we proceed with the printing. So far, always work ;)</span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"></span></div><div class="MsoNormal"><b><br /></b></div><div class="MsoNormal"><b>Why my images don't print or how can I print them?<o:p></o:p></b></div><div class="MsoNormal"></div><div class="MsoNormal"><span lang="EN-US">The only thing you should take care of when it comes to print images is specify the image URL in a way that is “reachable” by the web browser control. The code down below ain’t gonna work.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-q9bS0fCtHp0/UCGWl6dAugI/AAAAAAAAAQ0/sS9nJP0AV3M/s1600/url-image-not-work.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-q9bS0fCtHp0/UCGWl6dAugI/AAAAAAAAAQ0/sS9nJP0AV3M/s1600/url-image-not-work.png" /></a></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal">whereas this should work like a charm:</div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-QJ3Bg36WPIw/UCGWyOGKi2I/AAAAAAAAAQ8/jdSkXQF1Tvw/s1600/url-imgage-that-works.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-QJ3Bg36WPIw/UCGWyOGKi2I/AAAAAAAAAQ8/jdSkXQF1Tvw/s1600/url-imgage-that-works.png" /></a></div><div class="MsoNormal"><span lang="EN-US"></span></div><div class="MsoNormal"><b><span lang="EN-US">It’s possible to print without showing the print preview dialog?</span></b></div><div class="MsoNormal"><span lang="EN-US">Yes it is possible. Just download the sample app and run it. All the samples presented in this post print html without showing the print preview dialog.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"></span></div><div class="MsoNormal"><b><span lang="EN-US"><br /></span></b></div><div class="MsoNormal"><b><span lang="EN-US">How can I change the page orientation?<o:p></o:p></span></b></div><div class="MsoNormal"><span lang="EN-US">The answer is you cannot. It is possible to change the default page orientation modifying this key on the registry:<o:p></o:p></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-ljLr8wpfU2k/UCGXIAZsGnI/AAAAAAAAARE/W0Dvs_jdSbc/s1600/registry-key.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="190" src="http://3.bp.blogspot.com/-ljLr8wpfU2k/UCGXIAZsGnI/AAAAAAAAARE/W0Dvs_jdSbc/s640/registry-key.png" width="640" /></a></div><div class="MsoNormal"><span lang="EN-US"></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">But I recommend not to that. (and sometimes it doesn't work either).<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US">You can find more info at </span><a href="http://msdn.microsoft.com/en-us/library/ms905101.aspx"><span lang="EN-US">http://msdn.microsoft.com/en-us/library/ms905101.aspx</span></a><span lang="EN-US"><o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">* I also tried adding this header to the html without any luck<o:p></o:p></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-oGJhMbytOYY/UCGXZRcFt3I/AAAAAAAAARM/YouUlal5c_U/s1600/media-print-css.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-oGJhMbytOYY/UCGXZRcFt3I/AAAAAAAAARM/YouUlal5c_U/s1600/media-print-css.png" /></a></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US">So I think that’s all for those issues I've heard of. If you have any question about printing HTML, feel free to ping me, I'll try to answer it.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"><a href="https://xp-dev.com/svn/posts/WebBrowserPrinter" target="_blank">Download source and demo app</a></span></div><br /><br /><br /><br /><br /><br /><br /><br />