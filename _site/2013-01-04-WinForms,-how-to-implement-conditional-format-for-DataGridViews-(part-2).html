---           
layout: post
title: WinForms, how to implement conditional format for DataGridViews (part 2)
date: 2013-01-04 12:47:53 UTC
updated: 2013-01-04 12:47:53 UTC
comments: false
categories: C# DataGridView Roslyn WinForms
---
<br /><div class="MsoNormal"><span lang="EN-US">In the previous post I showed you how to implement conditional format functionality for datagridviews using C#, working on conditions that we already know at compile time, which means that those conditions will be written by programmers, not end users.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">In this post I’ll show you how to deal with user defined conditional formats, which is a more useful thing to do if what you want to provide this kind of functionality. With this new feature the users are going to be able to write conditions in an Excel fashion (formula like, if you will)<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">To implement this feature I’ve upgraded the project that we been using for this series to .NET Framework 4.5 in order to use the latest version of the Roslyn compiler. The Roslyn compiler is the backbone of this feature. If you are interested in Roslyn, I made a series on <a href="http://www.alemiralles.blogspot.com.ar/2012/11/roslyn-shopping-cart-part-1.html" target="_blank">How to build a DSL on top of Roslyn</a>&nbsp;that covers some basic stuff of this great piece of software.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">As in the Roslyn DSL series I'll rely on source to source translation to go from the expressions written by &nbsp;users to C# code and then execute that code using the Roslyn APIs.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">I’m going to use the same condition that I used in the previous post, but this time instead of using a function written in C# I’ll use a formula written in plain text (the same thing that the end user will do) and use a utility method to compile that formula into a C# function. <o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-DROGLFaaWrE/UObMuJ2SjKI/AAAAAAAAAdA/yTwYieE_UoA/s1600/user-input.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-DROGLFaaWrE/UObMuJ2SjKI/AAAAAAAAAdA/yTwYieE_UoA/s1600/user-input.png" /></a></div><div class="MsoNormal"><span lang="EN-US">If you run the sample app, you will see that the end result is the same that we get with the previous post.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-o2WXrEvXwPE/UObM0cJuooI/AAAAAAAAAdI/av3i4PsOREg/s1600/grid-layout.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-o2WXrEvXwPE/UObM0cJuooI/AAAAAAAAAdI/av3i4PsOREg/s1600/grid-layout.png" /></a></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"><b>This feature is not ready for prime time yet</b>, on large data sets the performance is not good (sucks, really), there’s no error checking or guidance for syntax errors, we are not persisting the conditional formats and so on and so fort… but I think it’s a good starting point if you have to implement this kind of functionality.&nbsp;</span></div><div class="MsoNormal"><span lang="EN-US">In the meantime I’ll continue working on this feature, sanding off rough edges and posting updates on this blog.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">You can get the code from&nbsp;<a href="https://github.com/amiralles/powergrid" target="_blank">here</a><o:p></o:p></span></div>