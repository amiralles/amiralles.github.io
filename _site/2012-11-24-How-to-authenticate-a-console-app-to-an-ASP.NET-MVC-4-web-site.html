---           
layout: post
title: How to authenticate a console app to an ASP.NET MVC 4 web site
date: 2012-11-24 13:31:36 UTC
updated: 2012-11-24 13:31:36 UTC
comments: false
categories: ASP.NET MVC 4
---
<br /><div class="MsoNormal"><span lang="EN-US">In this post I will show you how to authenticate an application to an ASP.NET MVC web site that uses forms authentication. This sounds a bit weird, but as I found out on the web, this is a fairly common thing to do these days.<a href="http://www.blogger.com/blogger.g?blogID=6425405359281783065" name="_GoBack"></a><o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">The most common scenario where people want to do this is, is when they want to consume an ASP.NET MVC web site as if it was a Web API, to get resources that are already in place and are accessible thru controller’s actions.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">There is couple of ways of doing this, and it is pretty easy until you need to authenticate the request in order to get those resources.<o:p></o:p></span>&nbsp;</div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">The web site we are working on uses Forms Authentication, this means that when a request arrives, the ASP.NET infrastructure is going to see if this request is authenticated or not, if is not, it will redirect the request to the login page. While this works fine for web pages, is not so good for APIs. Down below I’ll show how to authenticate a client to a login page using the HttpClient class.&nbsp;</span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">* note: I'm assuming that you 're familiar with the with the "internet app templete" that comes with asp.net mvc 4.0, If not, grab the sample project from this post and take a look at the AccountController class.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">This is how you can authenticate a request that otherwise it would be redirected to a login page.<o:p></o:p></span>&nbsp;</div><div class="MsoNormal"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-leW5Xu5svFY/UJ6Zq9wOcJI/AAAAAAAAAVw/dC0hdWmdRCw/s1600/login.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="342" src="http://4.bp.blogspot.com/-leW5Xu5svFY/UJ6Zq9wOcJI/AAAAAAAAAVw/dC0hdWmdRCw/s640/login.png" width="640" /></a></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">Once you have done that, you have client that can issue authenticated requests to your website.<o:p></o:p></span>&nbsp;</div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-eFx4v-QDyUw/UJ6ZqH8173I/AAAAAAAAAVo/wfyWRCYBkqw/s1600/get.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="356" src="http://2.bp.blogspot.com/-eFx4v-QDyUw/UJ6ZqH8173I/AAAAAAAAAVo/wfyWRCYBkqw/s640/get.png" width="640" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-Uz2_pxf-NuU/UJ6ZrTSb41I/AAAAAAAAAV4/VmuKK3T_X74/s1600/post.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="232" src="http://4.bp.blogspot.com/-Uz2_pxf-NuU/UJ6ZrTSb41I/AAAAAAAAAV4/VmuKK3T_X74/s640/post.png" width="640" /></a></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"><b>* note that I’m using the same HttpClient instance that executed the login request. If you don’t do it this way, it won’t work at all.</b><o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">You can get the sample app from github&nbsp;</span><a href="https://github.com/amiralles/http-client-forms-auth">https://github.com/amiralles/http-client-forms-auth</a></div><div class="MsoNormal"><br /></div><div class="MsoNormal"></div><div class="MsoNormal"><span lang="EN-US">The repository contains a solution with two projects, an ASP.NET MCV 4 web site and a console app that consume the web site as if it was an API.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">The web site it's also published on Windows Azure, so you can test the code in an environment other than localhost. Just change this line in the console app config.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-YLH1i_cNvWA/UJ6ZpmxcQTI/AAAAAAAAAVg/OGvI9Dg3RCY/s1600/config.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="102" src="http://3.bp.blogspot.com/-YLH1i_cNvWA/UJ6ZpmxcQTI/AAAAAAAAAVg/OGvI9Dg3RCY/s640/config.png" width="640" /></a></div><br />