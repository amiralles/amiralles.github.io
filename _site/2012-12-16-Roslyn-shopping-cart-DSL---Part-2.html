---           
layout: post
title: Roslyn shopping cart DSL - Part 2
date: 2012-12-16 14:16:09 UTC
updated: 2012-12-16 14:16:09 UTC
comments: false
categories: DSL Roslyn
---
<br /><div class="MsoNormal"><span lang="EN-US">In this post I will be reviewing some considerations that I usually have in mind while designing a DSL.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"><b>The audience</b><o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US">When you are working on a DSL, the first and most important thing to have in mind is the audience you are aiming for. It’s gonna be technical people, business executives, sales people, etc…, etc….<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span><span lang="EN-US"><b>The syntax</b><o:p></o:p></span></div><div class="MsoNormal">If the audience is not a bunch of techies, here is set of design rules that you should follow (at least, they've worked out for me):</div><div class="MsoNormal"></div><ul><li>The syntax should be as much as closest to the domain terms that the user uses on a daily basis.</li><li>Use sentences like “<b>when something_happen</b>:” instead of “<b>if (somethingHappen){..}</b>”.</li><li>Use logical operators like “<b>and</b>”, “<b>or</b>” instead of “<b>&amp;&amp;</b>”, “<b>||</b>”.</li><li>Don't make your syntax case sensitive.</li><li><b>snake_case</b>works better than PascalCase.</li><li>When syntax error happen (and it will happen) provide useful messages that lead the user to the right path.</li><li>Try to avoid the use of parentheses as much as you can. (our users are not Lisp programmers ;))</li><li>You are not building a general purpose language. <b>Avoid loops, conditionals and variables as much as you can</b>. Keep your DSL Turing incomplete.</li></ul><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US"><b>Working with scripts</b><o:p></o:p></span></div><div class="MsoNormal"></div><ul><li>Build a professional script editor (Notepad sucks, big time)</li><li>Use different icons to differentiate conditions from actions.</li><li>Provide an autocomplete mechanism and syntax highlight.</li><li>Don't try to build your own version of VS. It will take a butt load of time, and most of the features you built will never be used.</li><li>Provide a versioning mechanism for scripts.</li></ul><br /><div class="MsoNormal"><span lang="EN-US">This is how it looks the editor provided with the sample app of this post.<o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-hRfN33d38bQ/ULZAGCK6w8I/AAAAAAAAAXY/_TIoQvpyZdo/s1600/dsl-editor.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-hRfN33d38bQ/ULZAGCK6w8I/AAAAAAAAAXY/_TIoQvpyZdo/s1600/dsl-editor.png" /></a></div><div class="MsoNormal">The main component of the editor is a control called “Fast Colored TextBox” created by <a href="http://www.codeproject.com/script/Membership/View.aspx?mid=1005558" target="_blank">Pavel Torgashov</a>, all the credits to this guy, the control is awesome and works like a charm.</div><div class="MsoNormal"><br /></div><div class="MsoNormal"><b>How you will go from your DSL syntax to executable code</b></div><div class="MsoNormal"><span lang="EN-US">In this post I’m working with a technique called “source to source translation”, this means that I’ll be converting code from our DSL syntax into C# code in order to feed the Roslyn compiler. <o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">Note: The code provided with this post does not cover in deep how source to source translation works nor is a full or complete solution, it’s just going to work with the example I’m showing and maybe give you a starting point, but nothing else.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal">You can get the source code from github using this&nbsp;<a href="https://github.com/amiralles/roslyn-shopping-cart-dsl" target="_blank">link</a></div>