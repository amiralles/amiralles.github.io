---           
layout: post
title: How to copy event handlers from one control to another
date: 2012-11-28 15:14:08 UTC
updated: 2012-11-28 15:14:08 UTC
comments: false
categories: C# Hacking How To
---
<div align="center" class="MsoNormal" style="text-align: center;"><span style="font-family: Cambria, serif;"><span style="font-size: 19px; line-height: 21px;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK2"></a></span></span></div><div class="MsoNormal"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK4"></a><span lang="EN-US">Today at work, one of my partners in crime were working on a crazy customer requirement and ask me if I think that would be possible to copy event handlers from one control to another at run time and keeps things working correctly. I said yes, I think it’s possible and must be easy too, let’s take a look…<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">After a couple of minutes, we figure out that the Control class doesn´t expose any public method or property to get access to the collection of delegates attached to the control’s events.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">I did a fair amount of web research and found a lot of partial solutions but none that fit our needs. So I decide to roll my own solution, post it, and may help some who is facing the very same problem. <o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">Normally when we are working with events, we hook them up with handlers, writing a piece of code like this:<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">textBox1.TextChanged&nbsp;+=&nbsp;(s,&nbsp;e)&nbsp;=&gt;&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas;">MessageBox</span><span lang="EN-US" style="font-family: Consolas;">.Show(</span><span lang="EN-US" style="color: #a31515; font-family: Consolas;">"Hi&nbsp;there&nbsp;from&nbsp;handler&nbsp;1"</span><span lang="EN-US" style="font-family: Consolas;">);<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK7"></a><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 11pt;">It’s also common to attach more than one handler to the same event:<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 11pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK9"></a><span lang="EN-US" style="font-family: Consolas;">textBox1.TextChanged&nbsp;+=&nbsp;(s,&nbsp;e)&nbsp;=&gt;&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas;">MessageBox</span><span lang="EN-US" style="font-family: Consolas;">.Show(</span><span lang="EN-US" style="color: #a31515; font-family: Consolas;">"Hi&nbsp;there&nbsp;from&nbsp;handler&nbsp;1"</span><span lang="EN-US" style="font-family: Consolas;">);<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">textBox1.TextChanged&nbsp;+=&nbsp;(s,&nbsp;e)&nbsp;=&gt;&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas;">MessageBox</span><span lang="EN-US" style="font-family: Consolas;">.Show(</span><span lang="EN-US" style="color: #a31515; font-family: Consolas;">"Hi&nbsp;there&nbsp;from&nbsp;handler&nbsp;2"</span><span lang="EN-US" style="font-family: Consolas;">);<o:p></o:p></span></pre><div class="MsoNormal"><span lang="EN-US">//*(I’m using lambdas for shortness)<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK11"></a><span lang="EN-US">The requirement is provide some mechanism to create a new textbox &nbsp;at runtime (let say textBox2) and attach to it the list of handlers that had been attached to the textBox1 at design time. (We also need to destroy textBox1, but this is not the point)<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">In this post I’m assuming that you are familiar with events and you know the basic of how they work, so I’m not going to cover in deep the “events machinery” in .NET. However in order to move on, we need to review how handlers are (internally) attached to or detached from an event in .NET. <o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US">The snippet above is from the (decompiled) control class of the .NET Framework:<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK13"></a><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 10pt;">private</span><span lang="EN-US" style="font-family: Consolas; font-size: 10pt;">&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 10pt;">static</span><span lang="EN-US" style="font-family: Consolas; font-size: 10pt;">&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 10pt;">readonly</span><span lang="EN-US" style="font-family: Consolas; font-size: 10pt;">&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 10pt;">object</span><span lang="EN-US" style="font-family: Consolas; font-size: 10pt;">&nbsp;EventText&nbsp;=&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 10pt;">new</span><span lang="EN-US" style="font-family: Consolas; font-size: 10pt;">&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 10pt;">object</span><span lang="EN-US" style="font-family: Consolas; font-size: 10pt;">();<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><br /></div><pre style="background: white;"><span lang="EN-US" style="color: blue; font-family: Consolas;">public</span><span lang="EN-US" style="font-family: Consolas;">&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas;">event</span><span lang="EN-US" style="font-family: Consolas;">&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas;">EventHandler</span><span lang="EN-US" style="font-family: Consolas;">&nbsp;TextChanged&nbsp;{<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="color: blue; font-family: Consolas;">add</span><span lang="EN-US" style="font-family: Consolas;">&nbsp;{&nbsp;<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Events.AddHandler(EventText,&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas;">value</span><span lang="EN-US" style="font-family: Consolas;">);&nbsp;<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="color: blue; font-family: Consolas;">remove</span><span lang="EN-US" style="font-family: Consolas;">&nbsp;{&nbsp;<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Events.RemoveHandler(EventText,&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas;">value</span><span lang="EN-US" style="font-family: Consolas;">);<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">}<o:p></o:p></span></pre><div class="MsoNormal"><br /></div><div class="MsoNormal"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK15"></a><span lang="EN-US">Here “EventText”&nbsp;is the field (key) that the Control class uses to point a list of handlers (delegates) to a given event, in this case “TextChanged”.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">So when we write:<o:p></o:p></span></div><div class="MsoNormal"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK17"></a><span lang="EN-US" style="font-family: Consolas;">textBox1.TextChanged&nbsp;+=&nbsp;some delegate… <o:p></o:p></span></div><pre style="background: white;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK19"></a><span lang="EN-US" style="font-size: 12pt;">I</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">nternally</span><span lang="EN-US" style="font-size: 12pt;">,</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"> we are adding that delegate to the list of handlers.</span><span lang="EN-US" style="color: blue; font-family: Consolas;"> </span><span lang="EN-US" style="font-family: Consolas;"><o:p></o:p></span></pre><pre style="background: white;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK21"></a><span lang="EN-US" style="font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas;">add</span><span lang="EN-US" style="font-family: Consolas;">&nbsp;{&nbsp;<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Events.AddHandler(EventText,&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas;">value</span><span lang="EN-US" style="font-family: Consolas;">);&nbsp;<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK23"></a><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">Now that we understand the very basics about how internally works the process of add/remove event handlers, we can imagine that if somehow we can get the value of the property “Events” and know the correct key, we may able to pull off the collection of delegates attached to a specified event and iterating thru that collection, hopefully, get the delegates and accomplish our mission ;)<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">This solution makes heavily use reflection, mainly because as I said before, there is no public API to work against it. For instance, the property “Events”, is marked as protected in the Control class and there isn´t another way to access it (unless you are using extended controls or a like, but this isn’t our case) <o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><br /></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">The current implementation only works with events declared on the Control class. You can get the full list of supported events using .NET Reflector or a similar tool. If the event that you are looking for is not supported by the current implementation, you can make it work by modifying a few lines of code (more on this later).<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">First of all we need to get the list of handlers attached to an event and this handy method take cares of that.<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p>&nbsp;</o:p></span></pre><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK25"></a><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">public</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Dictionary</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&lt;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">string</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">,&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Dictionary</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&lt;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">object</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">,&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Delegate</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">[]&gt;&gt;&nbsp;GetHandlersFrom(</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Control</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;ctrl)&nbsp;{<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><br /></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; var</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;ctrlEventsCollection&nbsp;=&nbsp;(</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">EventHandlerList</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">)</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; &nbsp; &nbsp; typeof</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">(</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Control</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">)</span><span lang="EN-US" style="background-color: white; font-family: Consolas; font-size: 11.5pt;">.GetProperty(</span><span lang="EN-US" style="background-color: white; color: #a31515; font-family: Consolas; font-size: 11.5pt;">"Events"</span><span lang="EN-US" style="background-color: white; font-family: Consolas; font-size: 11.5pt;">,&nbsp;</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="background-color: white; color: #2b91af; font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; &nbsp; &nbsp; BF</span><span lang="EN-US" style="background-color: white; font-family: Consolas; font-size: 11.5pt;">.GetProperty&nbsp;|&nbsp;</span><span lang="EN-US" style="background-color: white; color: #2b91af; font-family: Consolas; font-size: 11.5pt;">BF</span><span lang="EN-US" style="background-color: white; font-family: Consolas; font-size: 11.5pt;">.NonPublic&nbsp;|&nbsp;</span><span lang="EN-US" style="background-color: white; color: #2b91af; font-family: Consolas; font-size: 11.5pt;">BF</span><span lang="EN-US" style="background-color: white; font-family: Consolas; font-size: 11.5pt;">.Instance)</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; &nbsp; &nbsp; .GetValue(ctrl,&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">null</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">);<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; var</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;headInfo&nbsp;=&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">typeof</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">(</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">EventHandlerList</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">)</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="background-color: white; font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.GetField(</span><span lang="EN-US" style="background-color: white; color: #a31515; font-family: Consolas; font-size: 11.5pt;">"head"</span><span lang="EN-US" style="background-color: white; font-family: Consolas; font-size: 11.5pt;">,&nbsp;</span><span lang="EN-US" style="background-color: white; color: #2b91af; font-family: Consolas; font-size: 11.5pt;">BF</span><span lang="EN-US" style="background-color: white; font-family: Consolas; font-size: 11.5pt;">.Instance&nbsp;|&nbsp;</span><span lang="EN-US" style="background-color: white; color: #2b91af; font-family: Consolas; font-size: 11.5pt;">BF</span><span lang="EN-US" style="background-color: white; font-family: Consolas; font-size: 11.5pt;">.NonPublic);</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;"><br /></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; </span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">var</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;handlers&nbsp;=&nbsp;BuildList(headInfo,&nbsp;ctrlEventsCollection);</span><span style="background-color: white; font-family: Consolas; font-size: 11.5pt;">&nbsp;</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp;&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">var</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;eventName&nbsp;=&nbsp;GetEventNameFromKey(ctrl,&nbsp;handlers.First().Key);</span><span style="background-color: white; font-family: Consolas; font-size: 11.5pt;">&nbsp;</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp;&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">var</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;result&nbsp;=&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">new</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Dictionary</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&lt;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">string</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">,&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Dictionary</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&lt;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">object</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">,&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Delegate</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">[]&gt;&gt;&nbsp;</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; &nbsp; &nbsp; {</span><span style="background-color: white; font-family: Consolas; font-size: 11.5pt;">{</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eventName,&nbsp;handlers&nbsp;</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp; &nbsp; &nbsp; &nbsp; }</span><span style="background-color: white; font-family: Consolas; font-size: 11.5pt;">};</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><br /></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">return</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;result;<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">}<o:p></o:p></span></div><pre style="background: white;"><span style="background-color: white; font-family: Calibri, sans-serif; font-size: 12pt;">&nbsp;</span></pre><pre style="background: white;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK27"></a><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">Now we have the delegates but we don´t know (yet) which is the event in the new control that we have to hookup.&nbsp; At this point we’re going to use a dictionary that contains some sort of map between the event’s name and the corresponding field in the Control class. Based on the key that we already have and using some reflection magic, we can attach those delegates to the correct event in our brand new control.<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK30"></a><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK29"></a><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">//The mapping<o:p></o:p></span></pre><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">_keyEventNameMapping&nbsp;=&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">new</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Dictionary</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&lt;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">string</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">,&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">string</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&gt;{<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span lang="EN-US" style="color: #a31515; font-family: Consolas; font-size: 11.5pt;">"EventAutoSizeChanged"</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">,&nbsp;</span><span lang="EN-US" style="color: #a31515; font-family: Consolas; font-size: 11.5pt;">"AutoSizeChanged"</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">},<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span lang="EN-US" style="color: #a31515; font-family: Consolas; font-size: 11.5pt;">"EventBackColor"</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">,&nbsp;</span><span lang="EN-US" style="color: #a31515; font-family: Consolas; font-size: 11.5pt;">"BackColorChanged"</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">},<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //etc, etc…<o:p></o:p></span></div><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><b><a href="http://www.blogger.com/post-create.g?blogID=6425405359281783065" name="OLE_LINK32"></a></b><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><b>How can I make it work if the event that I’m interested in is not defined in the control class?</b></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">Easy, if you want to extend this solution to work with events that are not defined in the control class<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">*&nbsp; Add the map in the </span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">_keyEventNameMapping field<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">* Modify this line in the CopyTo extension method<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;"><o:p>&nbsp;</o:p></span></pre><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="color: #4f6228; font-family: Consolas; font-size: 11.5pt;">//Instead of Control use the class you need<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">var</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;info&nbsp;=&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">typeof</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">(</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">Control</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">).GetField(innerKeyFieldName,<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">BF</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">.GetField&nbsp;|&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">BF</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">.Static&nbsp;|&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">BF</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">.NonPublic&nbsp;|&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 11.5pt;">BF</span><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;">.DeclaredOnly);<o:p></o:p></span></div><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><b>Running the sample Application:</b><o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">Once you download the sample app. run it and you’ll see a form with two textboxes and a button. If you enter text in the textbox labeled “Source” you’ll notice that two events will fire and the handlers attached to those events will show a message. Nothing should happen if you enter text in the textbox labeled destination.<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">Now, press the button named “Copy event handlers” and enters some text in the textbox labeled destination. If all went well, you should be seen the messages from the event handlers attached to the source textbox, now attached to the destination textbox.<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><b>Using the code:</b><o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">For copying handlers from one control to another you just need those two lines of code.<o:p></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Consolas; font-size: 11.5pt;"><o:p>&nbsp;</o:p></span></pre><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 11.5pt;">var</span><span lang="EN-US" style="font-family: Consolas; font-size: 12pt;"> _copyHelper&nbsp;=&nbsp;</span><span lang="EN-US" style="color: blue; font-family: Consolas; font-size: 12pt;">new</span><span lang="EN-US" style="font-family: Consolas; font-size: 12pt;">&nbsp;</span><span lang="EN-US" style="color: #2b91af; font-family: Consolas; font-size: 12pt;">CopyEventHandlers</span><span lang="EN-US" style="font-family: Consolas; font-size: 12pt;">();<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span lang="EN-US" style="font-family: Consolas; font-size: 12pt;">_copyHelper.GetHandlersFrom(textBox1).CopyTo(textBox2);<o:p></o:p></span></div><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p>&nbsp;</o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p><br /></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p><br /><a href="http://amiralles.com.ar/public_html/posts/how-to-copy-event-handlers/src.zip">Download Source</a><br /><a href="http://amiralles.com.ar/public_html/posts/how-to-copy-event-handlers/demoapp.zip">Download Sample App</a><br /></o:p></span></pre><pre style="background: white;"><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;">If you have any question about using the code, don’t hesitate con contact me, I’ll be glad to help.</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt;"><o:p></o:p></span></pre>