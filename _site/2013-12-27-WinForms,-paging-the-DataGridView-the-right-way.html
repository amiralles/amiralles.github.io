---           
layout: post
title: WinForms, paging the DataGridView the right way
date: 2013-12-27 13:55:36 UTC
updated: 2013-12-27 13:55:36 UTC
comments: false
categories: C# DataGridView WinForms
---
<br />I know this may sound like old history, but in the enterprise world there is still a lot of WinForms development. Just a couple of days ago, I had to implement a custom DataGridView capable to work over a butt load of data (100K+ records) and keep responses times acceptables.<br />I thought paging will be a good way to go, and as WinForms is pretty old nowadays, I supposed it will be easy to find a couple examples on the web.<br />While in fact I found examples, all of them were incompletes and/or they wouldn't perform well in real world apps... So I decided to roll my own component and post it online. Hopefully, someone else will find it useful ;).<br /><br /><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">The bread and butter of this solution relies on LINQ and deferred execution. As LINQ takes care of all complicated work, it was quite easy to implement.<o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US">This component also supports conditional format, sorting and some search capabilities, but in this post I will concentrate on paging only (I'll cover the rest of the features in future posts).<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">I’m assuming you are familiar with LINQ (or with how partial application works in C#)<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">The amazing thing on how this paging implementation works, is that you only have to do a little bit of configuration and the component will take care of the rest. This is how to configure the grid.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-XM36zwNCOCA/UN3piy9bwfI/AAAAAAAAAbU/c7Ab8LeuY9k/s1600/configuring-client-code.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-XM36zwNCOCA/UN3piy9bwfI/AAAAAAAAAbU/c7Ab8LeuY9k/s1600/configuring-client-code.png" /></a></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><b>To avoid performance killings (and to not spoil deferred execution) the row count should be specified separately.</b><br /><b><br /></b></div><div class="MsoNormal"><span lang="EN-US">And this is how internally works.<o:p></o:p></span></div><div class="MsoNormal">Configuring</div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-955zbARAZVg/UN3ofspFO0I/AAAAAAAAAbE/P0V9mMPRmrw/s1600/configure-grid.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-955zbARAZVg/UN3ofspFO0I/AAAAAAAAAbE/P0V9mMPRmrw/s1600/configure-grid.png" /></a></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">Paging</span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-414nM7lf51A/UN3o1OD1TRI/AAAAAAAAAbM/IH0JKEaiEHI/s1600/how-paging-works.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-414nM7lf51A/UN3o1OD1TRI/AAAAAAAAAbM/IH0JKEaiEHI/s1600/how-paging-works.png" /></a></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">Notice that when we execute the .ToList()&nbsp; method we only fetch a small set of records according to the grid’s page size (we don’t fetch the whole thing). In this case instead off fetching 50K records, we are fetching only 1K and caching them for later use. If the user asks for the same page twice, the second time, we will give him a cached version of that page (we hit the database only once per page).<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"></span></div><div class="MsoNormal"><span lang="EN-US">If the data source is mutable, when you detect a change you can invalidate the cahce and then start the whole process all over again.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">You can get the code from the github <a href="https://github.com/amiralles/powergrid" target="_blank">repo</a>.<o:p></o:p></span></div><br />