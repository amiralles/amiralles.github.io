---           
layout: post
title: Roslyn shopping cart DSL – Part 3
date: 2012-12-16 15:32:38 UTC
updated: 2012-12-16 15:32:38 UTC
comments: false
categories: DSL Roslyn
---
<br /><div class="MsoNormal"><span lang="EN-US">An effective way to create a DSL is by building a thin layer that runs on top of a façade that interacts with the domain objects.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US">This is how those components looks in the sample app of this post.</span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-QX__IUwDQ4s/UM3jE9CJDHI/AAAAAAAAAYs/idwbQe79aDI/s1600/dsl-diagram.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-QX__IUwDQ4s/UM3jE9CJDHI/AAAAAAAAAYs/idwbQe79aDI/s1600/dsl-diagram.png" /></a></div><div class="MsoNormal"></div><div class="MsoNormal"><span lang="EN-US">In this case, the DSL only talk to the façade and the façade is in charge of talking with domains objects (or services or whatever component that goes underneath). This makes things really easy to implement and fit perfectly to work with Roslyn, because if we use the façade as the Roslyn script engine’s host object, the engine will let us access directly from our DSL syntax to any member of the façade's public API.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">By looking at this unit test you will see how to wire up the components, execute the DSL script and modify the order state (the domain object) right from the DSL.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-P-q98BJp9PM/UM3nzil3uYI/AAAAAAAAAZk/IScodUbE1gE/s1600/dsl-wireup.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-P-q98BJp9PM/UM3nzil3uYI/AAAAAAAAAZk/IScodUbE1gE/s1600/dsl-wireup.png" /></a></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US">* If this were a real app, the order will continue with the processing pipeline. <o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">So far so good, now how to go from our DSL syntax to façade calls?<o:p></o:p></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-mHASqAy004M/UM3jHXsMJyI/AAAAAAAAAZE/5yrwgqkQeyk/s1600/dsl-to-csharp.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-mHASqAy004M/UM3jHXsMJyI/AAAAAAAAAZE/5yrwgqkQeyk/s1600/dsl-to-csharp.png" /></a></div><div class="MsoNormal"><span lang="EN-US">* Notice that the facade exposes the domain object's state and/or behaviour..</span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">If you take a look at the façade public API you will notice that almost every member matches with conditions and actions available on our DSL syntax (switching from Pascal Case to snake_case). As we mention earlier, any public member of the host object (in this case the façade) will be available right out of the box to our DSL, so with a little bit of source to source translation, this is pretty easy to achieve.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US"></span></div><div class="MsoNormal"><span lang="EN-US"><b>How to configure the façade as the engine’s host object</b><o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US">Configure the host object is pretty straight forward, it only takes a few lines of code.<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-lc7GoyOKHJE/UM3jEeiMv2I/AAAAAAAAAYk/SXgpJDd12c4/s1600/dsl-configure-host-object.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-lc7GoyOKHJE/UM3jEeiMv2I/AAAAAAAAAYk/SXgpJDd12c4/s1600/dsl-configure-host-object.png" /></a></div><div class="MsoNormal"><span lang="EN-US">And the rest of the work relies pretty much on source to source translation, which I will be covering in futures post.<o:p></o:p></span></div><br /><br />